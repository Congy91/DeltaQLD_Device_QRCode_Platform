{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <!-- Create Site / Device -->
    <div class="delta-card">
        <h2 class="text-xl font-semibold mb-2">Create Site</h2>
        <form method="POST" action="{{ url_for('add_site') }}">
            <input type="text" name="site_name" placeholder="Site name" class="w-full p-2 border rounded mb-2" required>
            <input type="text" name="site_url" placeholder="Site URL (optional)" class="w-full p-2 border rounded mb-2">
            <button class="px-3 py-2 delta-btn rounded">Add Site</button>
        </form>

        <h2 class="text-xl font-semibold mt-4 mb-2">Create Device (for label/QR)</h2>
        <form method="POST" action="{{ url_for('add_device') }}">
            <select name="site_id" class="w-full p-2 border rounded mb-2">
                <option value="">Assign site (optional)</option>
                {% for s in sites %}<option value="{{ s.id }}">{{ s.name }}</option>{% endfor %}
            </select>
            <input type="text" name="device_number" placeholder="Device number" class="w-full p-2 border rounded mb-2"
                required>
            <button class="px-3 py-2 delta-btn rounded">Create Device</button>
        </form>
    </div>

    <!-- Sites & QRs -->
    <div class="delta-card">
        <h2 class="text-xl font-semibold mb-2">Sites & Generate QRs</h2>
        {% if sites %}
        <ul class="space-y-3">
            {% for s in sites %}
            <li class="p-2 border rounded flex justify-between items-center">
                <div>
                    <div class="font-medium">
                        {% if s.url %}
                        <a href="{{ s.url }}" target="_blank">{{ s.name }}</a>
                        {% else %}
                        {{ s.name }}
                        {% endif %}
                    </div>
                    <div class="text-sm text-gray-600">{{ s.devices|length }} devices</div>
                </div>
                <div class="flex items-center space-x-2">
                    <a class="px-3 py-2 text-sm rounded border" href="{{ url_for('site_view', site_id=s.id) }}">View</a>
                    <a class="px-3 py-2 text-sm rounded border delta-btn text-white "
                        href="{{ url_for('generate_site_qr', site_id=s.id) }}">Site QR</a>

                    <!-- Delete Site Form -->
                    <form method="POST" action="{{ url_for('delete_site', site_id=s.id) }}"
                        onsubmit="return confirm('Are you sure you want to delete this site and all associated devices?');">
                        <button type="submit"
                            class="px-3 py-2 text-sm rounded border text-red-600 hover:bg-red-100">Delete</button>
                    </form>
                </div>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <div class="text-sm text-gray-500">No sites yet.</div>
        {% endif %}
    </div>
</div>
{% endblock %}